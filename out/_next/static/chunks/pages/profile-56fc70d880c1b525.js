(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{19344:(e,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return s(14078)}])},31275:(e,a,s)=>{"use strict";s.d(a,{oi:()=>k}),s(92890);var r=s(67294),l=s(36370),i=s(90512),t=s(64584),n=s(85893),d=Object.defineProperty,o=Object.defineProperties,c=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,h=(e,a,s)=>a in e?d(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,p=(e,a)=>{for(var s in a||(a={}))m.call(a,s)&&h(e,s,a[s]);if(u)for(var s of u(a))x.call(a,s)&&h(e,s,a[s]);return e},f=(e,a)=>o(e,c(a)),g=(e,a)=>{var s={};for(var r in e)m.call(e,r)&&0>a.indexOf(r)&&(s[r]=e[r]);if(null!=e&&u)for(var r of u(e))0>a.indexOf(r)&&x.call(e,r)&&(s[r]=e[r]);return s},v=(e,a)=>"".concat(e," returned `undefined`. Seems you forgot to wrap component within ").concat(a),w=()=>(e,a)=>a.reduce((e,a)=>{let[s,r]=e;return void 0!==r[a]&&(s[a]=r[a]),delete r[a],[s,r]},[{},p({},e)]),j=(0,t.c)({defaultClassName:"interactions__13di4x95 interactions__13di4x91 interactions-scale_normal__13di4x96 interactions__13di4x94 text-input__npu94q5",variantClassNames:{invalid:{true:"text-input-invalid_true__npu94q7"},size:{sm:"text-input-size_sm__npu94q8",md:"text-input-size_md__npu94q9",lg:"text-input-size_lg__npu94qa",xl:"text-input-size_xl__npu94qb"}},defaultVariants:{invalid:!1,size:"md"},compoundVariants:[]}),b=(0,t.c)({defaultClassName:"text-input__npu94q3 text-input__npu94q2",variantClassNames:{visuallyHidden:{true:"visually-hidden__1q7xssa0"}},defaultVariants:{visuallyHidden:!1},compoundVariants:[]}),N=(0,t.c)({defaultClassName:"text-input__npu94q0",variantClassNames:{disabled:{true:"text-input-disabled_true__npu94q1"}},defaultVariants:{disabled:!1},compoundVariants:[]}),[y,P]=function(){let{name:e,strict:a=!0,hookName:s="useContext",providerName:l="Provider",errorMessage:i,defaultValue:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,r.createContext)(t);return n.displayName=e,[n.Provider,function(){let e=(0,r.useContext)(n);if(!e&&a){let e=Error(null!=i?i:v(s,l));throw e.name="ContextError",e}return e},n]}({name:"TextInput",hookName:"useTextInputContext",providerName:"TextInputProvider"}),_=(0,r.forwardRef)((e,a)=>{var{className:s,children:t}=e,d=g(e,["className","children"]);let o=(0,r.useId)(),[c,u]=w()(d,["type","value","onValueChange","defaultValue","size","disabled","invalid","readOnly","visuallyHidden","placeholder"]),{disabled:m}=c;return(0,n.jsx)(y,{value:p({textInputId:o},c),children:(0,n.jsx)(l.WV.div,f(p({ref:a,className:(0,i.Z)(N({disabled:m}),s)},u),{children:t}))})});_.displayName="TextInput.Root";var C=(0,r.forwardRef)((e,a)=>{var{htmlFor:s,className:r}=e,t=g(e,["htmlFor","className"]);let{textInputId:d=s,visuallyHidden:o}=P();return(0,n.jsx)(l.WV.label,p({ref:a,htmlFor:d,className:(0,i.Z)(b({visuallyHidden:o}),r)},t))});C.displayName="TextInput.Label";var z=(0,r.forwardRef)((e,a)=>{var{id:s,className:r}=e,t=g(e,["id","className"]);let{type:d,textInputId:o=s,value:c,onValueChange:u,defaultValue:m,disabled:x,invalid:h,readOnly:f,size:v,placeholder:w}=P();return(0,n.jsx)(l.WV.input,p({ref:a,id:o,type:d,value:c,onChange:e=>null==u?void 0:u(e.target.value),defaultValue:m,disabled:x,"aria-invalid":h,readOnly:f,placeholder:w,className:(0,i.Z)(j({invalid:h,size:v}),r)},t))});z.displayName="TextInput.Field";var k={Root:_,Label:C,Field:z}},14078:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>j});var r=s(85893),l=s(31530),i=s(1539),t=s(31275),n=s(2026),d=s(74303),o=s(18237),c=s(11163),u=s(67294),m=s(74341),x=s(32726),h=s(19182),p=s(86727),f=s(22226);let g=e=>{let{currentImageUrl:a="",onImageChange:s,size:l="lg",disabled:i=!1,allowDelete:t=!0,userId:c}=e,[g,v]=(0,u.useState)(!1),[w,j]=(0,u.useState)(0),[b,N]=(0,u.useState)(""),[y,P]=(0,u.useState)(a),_=(0,u.useRef)(null),C=(0,u.useCallback)(async e=>{var r,l;let i=null===(r=e.target.files)||void 0===r?void 0:r[0];if(i){N(""),v(!0),j(0);try{if(await p.Z.validateFile(i),!i.type.startsWith("image/"))throw Error("이미지 파일만 업로드할 수 있습니다.");let e=p.Z.createPreviewUrl(i);P(e),console.log("Starting profile image upload:",{fileName:i.name,fileSize:p.Z.formatFileSize(i.size),fileType:i.type});let a=await p.Z.uploadProfileImage(i,c||(null===(l=h.Z.getCurrentUser())||void 0===l?void 0:l.id),e=>{j(e)});console.log("Profile image upload completed:",a),s&&s(a.url),e!==a.url&&p.Z.revokePreviewUrl(e),P(a.url)}catch(s){console.error("Profile image upload error:",s),N(s.message||"이미지 업로드에 실패했습니다."),P(a);let e=p.Z.createPreviewUrl(i);e&&p.Z.revokePreviewUrl(e)}finally{v(!1),j(0),_.current&&(_.current.value="")}}},[a,s,c]),z=(0,u.useCallback)(async()=>{if(y&&t&&!g&&window.confirm("프로필 이미지를 삭제하시겠습니까?")){N(""),v(!0);try{y!==a&&await p.Z.deleteFile(y),P(""),s&&s(""),console.log("Profile image deleted successfully")}catch(e){console.error("Profile image deletion error:",e),N("이미지 삭제에 실패했습니다.")}finally{v(!1)}}},[y,a,t,g,s]),k=(0,u.useCallback)(()=>{i||g||!_.current||_.current.click()},[i,g]),I=(0,u.useCallback)(async e=>{if(e.preventDefault(),i||g)return;let a=e.dataTransfer.files;if(a.length>0){let e=a[0],s=new DataTransfer;s.items.add(e),_.current&&(_.current.files=s.files,C({target:{files:s.files}}))}},[i,g,C]),E=(0,u.useCallback)(e=>{e.preventDefault()},[]),Z={sm:"w-16 h-16",md:"w-24 h-24",lg:"w-32 h-32",xl:"w-40 h-40"}[l]||"w-32 h-32";return(0,r.jsxs)(f.Kq,{spacing:"md",className:"profile-image-upload",children:[(0,r.jsxs)(f.xu,{className:"relative inline-block",children:[(0,r.jsxs)("div",{className:"".concat(Z," relative cursor-pointer group transition-all duration-200 hover:opacity-80"),onClick:k,onDrop:I,onDragOver:E,role:"button",tabIndex:0,"aria-label":"프로필 이미지 업로드",children:[(0,r.jsx)(m.qE,{src:y,size:l,className:"w-full h-full",alt:"프로필 이미지"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded-full flex items-center justify-center",children:g?(0,r.jsx)(o.LoadingOutlineIcon,{className:"w-6 h-6 text-white animate-spin"}):(0,r.jsx)(o.xmR,{className:"w-6 h-6 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}),t&&y&&!g&&(0,r.jsx)(x.h,{size:"sm",variant:"outline",onClick:z,className:"absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white border-red-500",title:"이미지 삭제","aria-label":"프로필 이미지 삭제",children:(0,r.jsx)(o.Dz5,{className:"w-3 h-3"})})]}),(0,r.jsx)("input",{ref:_,type:"file",accept:"image/*",onChange:C,disabled:i||g,className:"hidden","aria-hidden":"true"}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)(d.z,{onClick:k,disabled:i||g,variant:"outline",size:"sm",className:"flex items-center gap-2",children:g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.LoadingOutlineIcon,{className:"w-4 h-4 animate-spin"}),"업로드 중..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.xmR,{className:"w-4 h-4"}),"이미지 선택"]})})}),g?(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-1",children:[(0,r.jsx)("span",{children:"업로드 중..."}),(0,r.jsxs)("span",{children:[w,"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(w,"%")}})})]}):null,b?(0,r.jsx)(n.U,{color:"danger",className:"mt-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(o.oC6,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm",children:b})]})}):null,(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,r.jsx)("p",{children:"JPG, PNG, GIF, WebP 형식 지원"}),(0,r.jsx)("p",{children:"최대 파일 크기: 10MB"}),(0,r.jsx)("p",{children:"드래그 앤 드롭으로도 업로드 가능"})]})]})};var v=s(83867),w=s(6969);let j=(0,v.Q)(()=>{let[e,a]=(0,u.useState)(null),[s,m]=(0,u.useState)({name:"",currentPassword:"",newPassword:"",confirmPassword:""}),[x,p]=(0,u.useState)(""),[v,j]=(0,u.useState)(""),[b,N]=(0,u.useState)(""),[y,P]=(0,u.useState)(!1),_=(0,c.useRouter)(),C=(0,u.useRef)(null);(0,u.useEffect)(()=>{let e=h.Z.getCurrentUser();if(!e){_.push("/");return}if(!C.current&&e.email){let a=(0,w.FV)(e.email),s=(0,w.pJ)(a);C.current={backgroundColor:a,color:s}}a(e),m(a=>({...a,name:e.name})),p(e.profileImage||"")},[_]),(0,u.useEffect)(()=>{let e=()=>{let e=h.Z.getCurrentUser();e&&(a(e),p(e.profileImage||""))};return window.addEventListener("userProfileUpdate",e),()=>{window.removeEventListener("userProfileUpdate",e)}},[]);let z=(0,u.useCallback)(async e=>{try{j(""),console.log("Profile image changed to:",e),p(e);let s=h.Z.getCurrentUser();if(!s)throw Error("사용자 정보를 찾을 수 없습니다.");let r={...s,profileImage:e};localStorage.setItem("user",JSON.stringify(r)),a(r);try{await h.Z.updateProfileImage(e),console.log("Profile image URL saved to backend")}catch(e){console.warn("Failed to save profile image URL to backend:",e)}N("프로필 이미지가 업데이트되었습니다."),setTimeout(()=>{N("")},3e3),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){console.error("Image update error:",e),j("프로필 이미지 업데이트에 실패했습니다."),setTimeout(()=>{j("")},3e3)}},[]),k=async r=>{if(r.preventDefault(),j(""),N(""),s.newPassword!==s.confirmPassword){j("새 비밀번호가 일치하지 않습니다.");return}P(!0);try{if(s.currentPassword){if(!s.newPassword)throw Error("새 비밀번호를 입력해주세요.");await h.Z.changePassword(s.currentPassword,s.newPassword)}if(s.name!==e.name){let e=await h.Z.updateProfile({name:s.name});a(e)}N("프로필이 성공적으로 업데이트되었습니다."),m(e=>({...e,currentPassword:"",newPassword:"",confirmPassword:""})),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){var l,i;console.error("Profile update error:",e),j((null===(i=e.response)||void 0===i?void 0:null===(l=i.data)||void 0===l?void 0:l.message)||e.message||"프로필 업데이트 중 오류가 발생했습니다.")}finally{P(!1)}},I=e=>{let{name:a,value:s}=e.target;m(e=>({...e,[a]:s}))};return e?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto px-4",children:(0,r.jsx)(i.Zb,{className:"p-8",children:(0,r.jsxs)(f.Kq,{spacing:"lg",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(l.x,{size:"2xl",weight:"bold",className:"mb-2",children:"프로필 설정"}),(0,r.jsx)(l.x,{size:"sm",color:"gray",children:"프로필 정보를 수정할 수 있습니다."})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)(l.x,{size:"lg",weight:"semibold",className:"mb-4",children:"프로필 이미지"}),(0,r.jsx)(g,{currentImageUrl:x,onImageChange:z,size:"xl",userId:e.id,allowDelete:!0})]}),(0,r.jsx)("form",{onSubmit:k,children:(0,r.jsxs)(f.Kq,{spacing:"md",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.x,{size:"lg",weight:"semibold",className:"mb-4",children:"기본 정보"}),(0,r.jsxs)(f.Kq,{spacing:"sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.x,{size:"sm",weight:"medium",className:"mb-1",children:"이메일"}),(0,r.jsx)(t.oi,{value:e.email,disabled:!0,className:"bg-gray-100"}),(0,r.jsx)(l.x,{size:"xs",color:"gray",className:"mt-1",children:"이메일은 변경할 수 없습니다."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.x,{size:"sm",weight:"medium",className:"mb-1",children:"이름"}),(0,r.jsx)(t.oi,{name:"name",value:s.name,onChange:I,placeholder:"이름을 입력하세요",disabled:y})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.x,{size:"lg",weight:"semibold",className:"mb-4",children:"비밀번호 변경"}),(0,r.jsxs)(f.Kq,{spacing:"sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.x,{size:"sm",weight:"medium",className:"mb-1",children:"현재 비밀번호"}),(0,r.jsx)(t.oi,{name:"currentPassword",type:"password",value:s.currentPassword,onChange:I,placeholder:"현재 비밀번호를 입력하세요",disabled:y})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.x,{size:"sm",weight:"medium",className:"mb-1",children:"새 비밀번호"}),(0,r.jsx)(t.oi,{name:"newPassword",type:"password",value:s.newPassword,onChange:I,placeholder:"새 비밀번호를 입력하세요",disabled:y})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.x,{size:"sm",weight:"medium",className:"mb-1",children:"새 비밀번호 확인"}),(0,r.jsx)(t.oi,{name:"confirmPassword",type:"password",value:s.confirmPassword,onChange:I,placeholder:"새 비밀번호를 다시 입력하세요",disabled:y})]})]})]}),v&&(0,r.jsx)(n.U,{color:"danger",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(o.oC6,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:v})]})}),b&&(0,r.jsx)(n.U,{color:"success",children:(0,r.jsx)("span",{children:b})}),(0,r.jsxs)(f.kC,{justify:"between",align:"center",className:"pt-4",children:[(0,r.jsx)(d.z,{variant:"outline",onClick:()=>_.push("/chat-rooms"),disabled:y,children:"취소"}),(0,r.jsx)(d.z,{type:"submit",loading:y,disabled:y,children:y?"저장 중...":"변경 사항 저장"})]})]})})]})})})}):(0,r.jsx)(f.M5,{className:"min-h-screen",children:(0,r.jsx)(l.x,{children:"로딩 중..."})})})},92890:()=>{}},e=>{var a=a=>e(e.s=a);e.O(0,[834,586,76,244,942,888,774,179],()=>a(19344)),_N_E=e.O()}]);