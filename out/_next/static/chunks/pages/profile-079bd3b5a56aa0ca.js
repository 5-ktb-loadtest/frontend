(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{19344:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return t(14078)}])},16893:(e,r,t)=>{"use strict";t.d(r,{Z:()=>i});var a=t(85893),s=t(67294),l=t(74341),o=t(6969);let n=(0,s.forwardRef)((e,r)=>{var t,n;let{user:i,size:d="md",className:c="",onClick:u,showInitials:h=!0,...m}=e,[p,f]=(0,s.useState)(""),[w,g]=(0,s.useState)(!1),x=(0,s.useCallback)(e=>e?e.startsWith("http")?e:"".concat("http://localhost:3001").concat(e):null,[]);(0,s.useEffect)(()=>{let e=x(null==i?void 0:i.profileImage);e&&e!==p?(g(!1),f(e)):e||f("")},[null==i?void 0:i.profileImage,x,p]),(0,s.useEffect)(()=>{let e=()=>{try{let e=JSON.parse(localStorage.getItem("user")||"{}");if((null==i?void 0:i.id)===e.id&&e.profileImage!==i.profileImage){let r=x(e.profileImage);g(!1),f(r)}}catch(e){console.error("Profile update handling error:",e)}};return window.addEventListener("userProfileUpdate",e),()=>{window.removeEventListener("userProfileUpdate",e)}},[x,null==i?void 0:i.id,null==i?void 0:i.profileImage]);let v=(0,o.hA)(null==i?void 0:i.email);return(0,a.jsxs)(l.qE.Root,{ref:r,size:(e=>{switch(e){case"sm":return"sm";case"lg":return"lg";case"xl":return"xl";default:return"md"}})(d),className:c,onClick:u,src:p&&!w?p:void 0,style:{backgroundColor:v.backgroundColor,color:v.color,cursor:u?"pointer":"default",...m.style},...m,children:[p&&!w?(0,a.jsx)(l.qE.Image,{onError:e=>{e.preventDefault(),g(!0),console.debug("Avatar image load failed:",{user:null==i?void 0:i.name,email:null==i?void 0:i.email,imageUrl:p})},alt:"".concat(null==i?void 0:i.name,"'s profile")}):null,(0,a.jsx)(l.qE.Fallback,{style:{backgroundColor:v.backgroundColor,color:v.color,fontWeight:"500"},children:h?(null==i?void 0:null===(n=i.name)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.toUpperCase())||"?":""})]})});n.displayName="PersistentAvatar";let i=n},83867:(e,r,t)=>{"use strict";t.d(r,{Q:()=>i,v:()=>d});var a=t(85893),s=t(67294),l=t(11163),o=t(31530),n=t(19182);let i=e=>{let r=r=>{let t=(0,l.useRouter)(),[o,i]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{n.Z.getCurrentUser()?i(!1):t.replace("/?redirect="+t.asPath)},[t]),o)?null:(0,a.jsx)(e,{...r})},t=e.displayName||e.name||"Component";return r.displayName="WithAuth(".concat(t,")"),r},d=e=>{let r=r=>{let t=(0,l.useRouter)(),[i,d]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{(async()=>{t.isReady&&(n.Z.getCurrentUser()&&"/"===t.pathname?await t.replace("/chat-rooms"):d(!1))})()},[t,t.isReady]),i)?(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"var(--vapor-color-background)",color:"var(--vapor-color-text-primary)"},children:(0,a.jsx)(o.x,{typography:"body1",children:"Loading..."})}):(0,a.jsx)(e,{...r})},t=e.displayName||e.name||"Component";return r.displayName="WithoutAuth(".concat(t,")"),r}},14078:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var a=t(85893),s=t(67294),l=t(11163),o=t(18237),n=t(1539),i=t(31530),d=t(2026),c=t(31275),u=t(74303),h=t(22226),m=t(19182),p=t(83867),f=t(32726),w=t(16893);let g=e=>{let{currentImage:r,onImageChange:t}=e,[l,n]=(0,s.useState)(null),[c,h]=(0,s.useState)(""),[p,g]=(0,s.useState)(!1),x=(0,s.useRef)(null),v=e=>e?e.startsWith("http")?e:"".concat("http://localhost:3001").concat(e):null;(0,s.useEffect)(()=>{n(v(r))},[r]);let j=async e=>{var a;let s=null===(a=e.target.files)||void 0===a?void 0:a[0];if(s)try{if(!s.type.startsWith("image/"))throw Error("이미지 파일만 업로드할 수 있습니다.");if(s.size>5242880)throw Error("파일 크기는 5MB를 초과할 수 없습니다.");g(!0),h("");let e=URL.createObjectURL(s);n(e);let r=m.Z.getCurrentUser();if(!(null==r?void 0:r.token))throw Error("인증 정보가 없습니다.");let a=new FormData;a.append("profileImage",s);let l=await fetch("".concat("http://localhost:3001","/api/users/profile-image"),{method:"POST",headers:{"x-auth-token":r.token,"x-session-id":r.sessionId},body:a});if(!l.ok){let e=await l.json();throw Error(e.message||"이미지 업로드에 실패했습니다.")}let o=await l.json(),i={...r,profileImage:o.imageUrl};localStorage.setItem("user",JSON.stringify(i)),t(o.imageUrl),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){console.error("Image upload error:",e),h(e.message),n(v(r)),l&&l.startsWith("blob:")&&URL.revokeObjectURL(l)}finally{g(!1),x.current&&(x.current.value="")}},y=async()=>{try{g(!0),h("");let e=m.Z.getCurrentUser();if(!(null==e?void 0:e.token))throw Error("인증 정보가 없습니다.");let r=await fetch("".concat("http://localhost:3001","/api/users/profile-image"),{method:"DELETE",headers:{"x-auth-token":e.token,"x-session-id":e.sessionId}});if(!r.ok){let e=await r.json();throw Error(e.message||"이미지 삭제에 실패했습니다.")}let a={...e,profileImage:""};localStorage.setItem("user",JSON.stringify(a)),l&&l.startsWith("blob:")&&URL.revokeObjectURL(l),n(null),t(""),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){console.error("Image removal error:",e),h(e.message)}finally{g(!1)}};(0,s.useEffect)(()=>()=>{l&&l.startsWith("blob:")&&URL.revokeObjectURL(l)},[l]);let b=m.Z.getCurrentUser();return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(w.Z,{user:b,size:"xl",className:"mx-auto mb-2",showInitials:!0}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)(u.z,{variant:"outline",onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()},disabled:p,size:"sm",children:[(0,a.jsx)(o.xmR,{size:16}),(0,a.jsx)("span",{style:{marginLeft:"8px"},children:"이미지 변경"})]}),l&&(0,a.jsx)(f.h,{variant:"outline",color:"danger",onClick:y,disabled:p,style:{marginLeft:"8px"},children:(0,a.jsx)(o.yNA,{size:16})})]})]}),(0,a.jsx)("input",{ref:x,type:"file",className:"hidden",accept:"image/*",onChange:j}),c&&(0,a.jsx)("div",{className:"w-full max-w-sm mx-auto",children:(0,a.jsx)(d.U,{color:"danger",className:"mt-2",children:c})}),p&&(0,a.jsx)(i.x,{typography:"body3",color:"neutral-weak",className:"text-center mt-2",children:"이미지 업로드 중..."})]})};var x=t(6969);let v=(0,p.Q)(()=>{let[e,r]=(0,s.useState)(null),[t,p]=(0,s.useState)({name:"",currentPassword:"",newPassword:"",confirmPassword:""}),[f,w]=(0,s.useState)(""),[v,j]=(0,s.useState)(""),[y,b]=(0,s.useState)(""),[C,E]=(0,s.useState)(!1),P=(0,l.useRouter)(),k=(0,s.useRef)(null),I=(0,s.useCallback)(e=>e?e.startsWith("http")?e:"".concat("http://localhost:3001").concat(e):null,[]);(0,s.useEffect)(()=>{let e=m.Z.getCurrentUser();if(!e){P.push("/");return}if(!k.current&&e.email){let r=(0,x.FV)(e.email),t=(0,x.pJ)(r);k.current={backgroundColor:r,color:t}}r(e),p(r=>({...r,name:e.name})),w(e.profileImage||"")},[P,I]),(0,s.useEffect)(()=>{let e=()=>{let e=m.Z.getCurrentUser();e&&(r(e),w(e.profileImage||""))};return window.addEventListener("userProfileUpdate",e),()=>{window.removeEventListener("userProfileUpdate",e)}},[]);let F=(0,s.useCallback)(async e=>{try{I(e),w(e);let t=m.Z.getCurrentUser();if(!t)throw Error("사용자 정보를 찾을 수 없습니다.");let a={...t,profileImage:e};localStorage.setItem("user",JSON.stringify(a)),r(a),b("프로필 이미지가 업데이트되었습니다."),setTimeout(()=>{b("")},3e3),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){console.error("Image update error:",e),j("프로필 이미지 업데이트에 실패했습니다."),setTimeout(()=>{j("")},3e3)}},[I]),U=async a=>{if(a.preventDefault(),j(""),b(""),t.newPassword!==t.confirmPassword){j("새 비밀번호가 일치하지 않습니다.");return}E(!0);try{if(t.currentPassword){if(!t.newPassword)throw Error("새 비밀번호를 입력해주세요.");await m.Z.changePassword(t.currentPassword,t.newPassword)}if(t.name!==e.name){let e=await m.Z.updateProfile({name:t.name});r(e)}b("프로필이 성공적으로 업데이트되었습니다."),p(e=>({...e,currentPassword:"",newPassword:"",confirmPassword:""})),window.dispatchEvent(new Event("userProfileUpdate"))}catch(e){var s,l;console.error("Profile update error:",e),j((null===(l=e.response)||void 0===l?void 0:null===(s=l.data)||void 0===s?void 0:s.message)||e.message||"프로필 업데이트 중 오류가 발생했습니다.")}finally{E(!1)}};return e?(0,a.jsx)("div",{className:"auth-container",children:(0,a.jsx)(n.Zb.Root,{className:"auth-card",children:(0,a.jsx)(n.Zb.Body,{className:"card-body",children:(0,a.jsxs)(h.Kq,{gap:"400",children:[(0,a.jsx)(h.M5,{children:(0,a.jsx)(i.x,{typography:"heading3",children:"프로필 설정"})}),(0,a.jsx)(h.M5,{children:(0,a.jsx)(g,{currentImage:f,onImageChange:F})}),v&&(0,a.jsx)(h.xu,{mt:"400",children:(0,a.jsx)(d.U,{color:"danger",children:(0,a.jsxs)(h.kC,{align:"center",gap:"200",children:[(0,a.jsx)(o.oC6,{size:16}),(0,a.jsx)(i.x,{children:v})]})})}),y&&(0,a.jsx)(h.xu,{mt:"400",children:(0,a.jsx)(d.U,{color:"success",children:(0,a.jsx)(i.x,{children:y})})}),(0,a.jsx)(h.xu,{mt:"400",children:(0,a.jsx)("form",{onSubmit:U,children:(0,a.jsxs)(h.Kq,{gap:"300",children:[(0,a.jsx)(h.xu,{children:(0,a.jsxs)(c.oi.Root,{type:"email",value:e.email,disabled:!0,children:[(0,a.jsx)(c.oi.Label,{children:"이메일"}),(0,a.jsx)(c.oi.Field,{id:"email",name:"email",required:!0,style:{width:"100%"}})]})}),(0,a.jsx)(h.xu,{children:(0,a.jsxs)(c.oi.Root,{type:"text",value:t.name,onValueChange:e=>p(r=>({...r,name:e})),disabled:C,children:[(0,a.jsx)(c.oi.Label,{children:"이름"}),(0,a.jsx)(c.oi.Field,{id:"name",name:"name",placeholder:"이름을 입력하세요",required:!0,style:{width:"100%"}})]})}),(0,a.jsx)(h.xu,{children:(0,a.jsxs)(c.oi.Root,{type:"password",value:t.currentPassword,onValueChange:e=>p(r=>({...r,currentPassword:e})),disabled:C,children:[(0,a.jsx)(c.oi.Label,{children:"현재 비밀번호"}),(0,a.jsx)(c.oi.Field,{id:"currentPassword",name:"currentPassword",placeholder:"현재 비밀번호를 입력하세요",style:{width:"100%"}})]})}),(0,a.jsx)(h.xu,{children:(0,a.jsxs)(c.oi.Root,{type:"password",value:t.newPassword,onValueChange:e=>p(r=>({...r,newPassword:e})),disabled:C,children:[(0,a.jsx)(c.oi.Label,{children:"새 비밀번호"}),(0,a.jsx)(c.oi.Field,{id:"newPassword",name:"newPassword",placeholder:"새 비밀번호를 입력하세요",style:{width:"100%"}})]})}),(0,a.jsx)(h.xu,{children:(0,a.jsxs)(c.oi.Root,{type:"password",value:t.confirmPassword,onValueChange:e=>p(r=>({...r,confirmPassword:e})),disabled:C,children:[(0,a.jsx)(c.oi.Label,{children:"새 비밀번호 확인"}),(0,a.jsx)(c.oi.Field,{id:"confirmPassword",name:"confirmPassword",placeholder:"새 비밀번호를 다시 입력하세요",style:{width:"100%"}})]})}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"var(--vapor-space-300)",marginTop:"var(--vapor-space-300)",width:"100%"},children:[(0,a.jsx)(u.z,{type:"submit",color:"primary",size:"md",disabled:C,children:C?"저장 중...":"저장"}),(0,a.jsx)(u.z,{type:"button",variant:"outline",color:"secondary",size:"md",onClick:()=>P.back(),disabled:C,children:"취소"})]})]})})})]})})})}):null})},6969:(e,r,t)=>{"use strict";t.d(r,{FV:()=>n,eK:()=>o,hA:()=>d,pJ:()=>i});let a=new Map,s={wayneAI:{backgroundColor:"#0084ff",color:"#FFFFFF"},consultingAI:{backgroundColor:"#00C853",color:"#FFFFFF"}},l=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#D4A5A5","#9B5DE5","#F15BB5","#00BBF9","#00F5D4","#738276","#A6D8D4"],o=e=>{if(!e)return s.wayneAI;let r=e.toLowerCase();return"wayneai"===r?s.wayneAI:"consultingai"===r?s.consultingAI:s.wayneAI},n=e=>{if(!e)return"#0084ff";if(a.has(e))return a.get(e);if(e.endsWith("@wayne.ai"))return a.set(e,s.wayneAI.backgroundColor),s.wayneAI.backgroundColor;if(e.endsWith("@consulting.ai"))return a.set(e,s.consultingAI.backgroundColor),s.consultingAI.backgroundColor;let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r&=r;let t=l[Math.abs(r)%l.length];return a.set(e,t),t},i=e=>{if(!e)return"#000000";let r=parseInt(e.slice(1,3),16);return(299*r+587*parseInt(e.slice(3,5),16)+114*parseInt(e.slice(5,7),16))/1e3>=128?"#000000":"#FFFFFF"},d=e=>{if(!e)return{};let r=n(e),t=i(r);return{backgroundColor:r,color:t}}}},e=>{var r=r=>e(e.s=r);e.O(0,[834,553,888,774,179],()=>r(19344)),_N_E=e.O()}]);